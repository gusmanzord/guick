#set( $js  = "$")
#set( $entityBeanName = ${util.uncapitalize($entity.name)} )
#set( $projectBeanName = ${util.uncapitalize($project.name)} )

(function() {
	'use strict';

/**
 *  Guick Generate class: https://github.com/wdavilaneto/guick
 *  Author: service-wdavilaneto@redhat.com
 *  This source is free under The Apache Software License, Version 2.0
 *  license url http://www.apache.org/licenses/LICENSE-2.0.txt
 *
 * @ngdoc function
 * @name ${projectBeanName}App.controller:${entityBeanName}Controller
 * @description
 * # ${entityBeanName}Controller
 * Controller of the ${projectBeanName}App
 */
angular.module('${projectBeanName}App')

    .controller('${entityBeanName}EditController', ['${js}scope', '${js}state', '${js}stateParams', '${js}modal', '${js}location', 'jsog', '${entityBeanName}Service', #foreach( ${ent} in ${entity.getDistinctedAllComplexProperties()})#set( $beanName = ${util.uncapitalize($ent.referedEntity.name)} )#if(${beanName} != ${entityBeanName})'${beanName}Service', #{end}#{end}
     function (${js}scope, ${js}state, ${js}stateParams , ${js}modal, ${js}location, jsog, ${entityBeanName}Service #foreach( ${ent} in ${entity.getDistinctedAllComplexProperties()})#set( $beanName = ${util.uncapitalize($ent.referedEntity.name)} )#if(${beanName} != ${entityBeanName}), ${beanName}Service#{end}#{end} ) {

    // ***************************
    // Model Initializations
    // ***************************
    ${js}scope.maxSelectBoxSize = 300;
    ${js}scope.original = {};
    ${js}scope.entity = ${entityBeanName}Service.create();
    ${js}scope.searchSelects = ${entityBeanName}Service.factorySearchSelect(); // Text Search Select utility Object

    $scope.clearForm = function () {
        $scope.entity = $scope.original;
    };

    // ************************************
    // watches
    // ************************************
    $scope.changeTab = function (tab) {
      $state.go(tab);
      $scope.tabSelected = tab;
    }

    // ****************************************
    // Controller init (on load) service calls
    // ****************************************
    ${js}scope.tabs = [];
    ${js}scope.tabs.push({heading: "Principal", route: "${entity.beanName}Edit.main", icon: "mdi-home"});
#foreach( ${complexProperty} in ${entity.getManyToOneProperties()})
#if(!${complexProperty.referedEntity.looksLikeEnum()} )
    ${js}scope.tabs.push({heading: "${complexProperty.title}", route: "${entity.beanName}Edit.${complexProperty.beanName}", icon: "mdi-eye"});
#end
#end
#foreach( ${complexProperty} in ${entity.getDistinctedAllComplexProperties()})
#if (${complexProperty.isOneToMany()} ) ## || ${complexProperty.isManyToMany()}
##  // TODO Many to many needs special query
    ${js}scope.tabs.push({heading: "${complexProperty.title}", route: "${entity.beanName}Edit.${complexProperty.beanName}", icon: "mdi-label"});
#end
#end
    ${js}scope.tabSelected = '${entity.beanName}.main';

}]);




/**
 *  Guick Generate class: https://github.com/wdavilaneto/guick
 *  Author: service-wdavilaneto@redhat.com
 *  This source is free under The Apache Software License, Version 2.0
 *  license url http://www.apache.org/licenses/LICENSE-2.0.txt
 *
 * @ngdoc function
 * @name ${projectBeanName}App.controller:${entityBeanName}Controller
 * @description
 * # ${entityBeanName}Controller
 * Modal Controller for ${entity.name} of the ${projectBeanName}App
 */
angular.module('${projectBeanName}App').controller('Modal${entity.name}Controller', ['${js}scope', '${js}location', '${js}modalInstance', 'jsog', '${entityBeanName}Service', #foreach( ${ent} in ${entity.getDistinctedAllComplexProperties()})#set( $beanName = ${util.uncapitalize($ent.referedEntity.name)} )#if(${beanName} != ${entityBeanName})'${beanName}Service', #{end}#{end} 'data',  function (${js}scope, ${js}location, ${js}modalInstance, jsog, ${entityBeanName}Service #foreach( ${ent} in ${entity.getDistinctedAllComplexProperties()})#set( $beanName = ${util.uncapitalize($ent.referedEntity.name)} )#if(${beanName} != ${entityBeanName}), ${beanName}Service#{end}#{end} , data, readonly) {
    console.log('View/Editing Modal' );
    console.log(data);
    ${js}scope.entity = data;//.${entity.beanName};
    ${js}scope.searchSelects = ${entityBeanName}Service.factorySearchSelect();
    ${js}scope.searchSelects.fromEntity(${js}scope.entity);

    if (!readonly) {
    // Selects to Fullfill select boxes
    // Begin block
#foreach( ${ent} in ${entity.getDistinctedAllComplexProperties()})
#if( ${ent.isManyToOne()} && !${ent.referedEntity.looksLikeMainEntity()}) ## Caso nao seja muito grande e portanto caiba num select box ...
#set( $beanName = ${util.uncapitalize($ent.referedEntity.name)} )
    ${beanName}Service.findAll( {page:1 , size:${js}scope.maxSelectBoxSize}  , function (data) {
         ${js}scope.${beanName}List = jsog.decode(data.content);
    });
#end
#end
    }
    // end block

    ${js}scope.save = function () {
        console.log('Saving Modal' );
        ${js}scope.searchSelects.toEntity(${js}scope.entity);
        ${entityBeanName}Service.save( ${js}scope.entity , function (successResult) {
            console.log(successResult);
            ${js}scope.entity = {};
            ${js}modalInstance.close(${js}scope.entity);
        });
    };

    $scope.remove = function (){
       console.log('Deleting ${entityBeanName} with id:' + ${js}scope.entity.id);
       ${entityBeanName}Service.remove( {id:${js}scope.entity.id}  , function ( successResult) {
           console.log(successResult);
           ${js}modalInstance.close(${js}scope.entity);
           ${js}state.go('${entity.beanName}.main', {}, {reload: true});
       });
    };

    ${js}scope.cancel = function () {
        ${js}modalInstance.dismiss('cancel');
    };

}]);

})();
